%
% packets.tex
%
% Copyright (C) 2021 by SpaceLab.
%
% FloripaSat-2 Documentation
%
% This work is licensed under the Creative Commons Attribution-ShareAlike 4.0
% International License. To view a copy of this license,
% visit http://creativecommons.org/licenses/by-sa/4.0/.
%

%
% \brief Telecommunication packets appendix.
%
% \author Gabriel Mariano Marcelino <gabriel.mm8@gmail.com>
%
% \institution Universidade Federal de Santa Catarina (UFSC)
%
% \version 0.9.0
%
% \date 2021/06/03
%

\chapter{Telecommunication Packets} \label{anx:packets}

This appendix lists all the packets used by the RF links of the satellite: Beacon, downlink and uplink. The fields and length of each type of packet is also presented.

\section{Beacon}

The \autoref{tab:beacon-packets} presents the content of the beacon packets.

\begin{longtable}[c]{lcL{0.4\textwidth}c}
    \toprule[1.5pt]
    \textbf{Packet} & \textbf{Position} & \textbf{Content} & \textbf{Length [bytes]} \\
    \midrule
    \multirow{22}{*}{EPS data} & 0  & Packet ID (00h)                       & 1 \\
                               & 1  & Source callsign (`` PY0EFS'')         & 7 \\
                               & 8  & Timestamp in ms                       & 4 \\
                               & 12 & Battery cell 1 voltage in mV          & 2 \\
                               & 14 & Battery cell 2 voltage in mV          & 2 \\
                               & 16 & Battery current in mA                 & 2 \\
                               & 18 & Battery charge in mAh                 & 2 \\
                               & 20 & Battery cell 1 temperature in K       & 2 \\
                               & 22 & Battery cell 2 temperature in K       & 2 \\
                               & 24 & Battery monitor temperature in K      & 2 \\
                               & 26 & Solar panel voltage in mV (-Y and +X) & 2 \\
                               & 28 & Solar panel voltage in mV (-X and +Z) & 2 \\
                               & 30 & Solar panel voltage in mV (-Z and +Y) & 2 \\
                               & 32 & Solar panel current in mA (-Y)        & 2 \\
                               & 34 & Solar panel current in mA (+Y)        & 2 \\
                               & 36 & Solar panel current in mA (-X)        & 2 \\
                               & 38 & Solar panel current in mA (+X)        & 2 \\
                               & 40 & Solar panel current in mA (-Z)        & 2 \\
                               & 42 & Solar panel current in mA (+Z)        & 2 \\
                               & 44 & Temperature of the EPS $\mu$C in K    & 2 \\
    \cmidrule{4-4}
                               &    &                                       & 46 \\
    \midrule
    \multirow{9}{*}{TTC data}  & 0  & Packet ID (01h)                       & 1 \\
                               & 1  & Source callsign (`` PY0EFS'')         & 7 \\
                               & 8  & Timestamp in ms                       & 4 \\
                               & 12 & Temperature of the TTC $\mu$C in K    & 2 \\
                               & 14 & Reset counter                         & 2 \\
                               & 16 & Last reset cause                      & 1 \\
                               & 15 & Temperature of the beacon radio in K  & 2 \\
    \cmidrule{4-4}
                               &    &                                       & 19 \\
    \bottomrule[1.5pt]
    \caption{Beacon packets.}
    \label{tab:beacon-packets}
\end{longtable}

\section{Downlink}

In \autoref{tab:downlink-packets} the content of the downlink packets is available.

\begin{longtable}[c]{lcL{0.4\textwidth}c}
    \toprule[1.5pt]
    \textbf{Packet} & \textbf{Position} & \textbf{Content} & \textbf{Length [bytes]} \\
    \midrule
    \multirow{42}{*}{General telemetry}     & 0  & Packet ID (20h)                              & 1 \\
                                            & 1  & Source callsign (`` PY0EFS'')                & 7 \\
                                            & 8  & Time counter in milliseconds                 & 4 \\
                                            & 12 & Temperature of the OBDH $\mu$C in Kelvin     & 2 \\
                                            & 14 & Input current of the OBDH in mA              & 2 \\
                                            & 16 & Input voltage of the OBDH in mV              & 2 \\
                                            & 18 & Last reset cause of the OBDH                 & 1 \\
                                            & 19 & Reset counter of the OBDH                    & 2 \\
                                            & 21 & Last valid telecommand (uplink packet ID)    & 1 \\
                                            & 22 & Temperature of the radio in Kelvin           & 2 \\
                                            & 24 & RSSI of the last valid telecommand           & 2 \\
                                            & 26 & Temperature of the antenna in Kelvin         & 2 \\
                                            & 28 & Antenna status                               & 2 \\
                                            & 30 & Payloads status                              & 1 \\
                                            & 31 & Temperature of the EPS $\mu$C in K           & 2 \\
                                            & 33 & EPS circuitry and Beacon MCU current in mA   & 2 \\
                                            & 35 & Last reset cause of the EPS                  & 1 \\
                                            & 36 & Reset counter (EPS)                          & 2 \\
                                            & 38 & -Y and +X sides solar panel voltage in mV    & 2 \\
                                            & 40 & -X and +Z sides solar panel voltage in mV    & 2 \\
                                            & 42 & -Z and +Y sides solar panel voltage in mV    & 2 \\
                                            & 44 & -Y side solar panel current in mA            & 2 \\
                                            & 46 & +Y side solar panel current in mA            & 2 \\
                                            & 48 & -X side solar panel current in mA            & 2 \\
                                            & 50 & +X side solar panel current in mA            & 2 \\
                                            & 52 & -Z side solar panel current in mA            & 2 \\
                                            & 54 & +Z side solar panel current in mA            & 2 \\
                                            & 55 & MPPT 1 duty cycle in \%                      & 1 \\
                                            & 56 & MPPT 2 duty cycle in \%                      & 1 \\
                                            & 57 & MPPT 3 duty cycle in \%                      & 1 \\
                                            & 59 & Main power bus voltage in mV                 & 2 \\
                                            & 61 & Batteries voltage in mV                      & 2 \\
                                            & 63 & Batteries current in mA                      & 2 \\
                                            & 65 & Batteries average current in mA              & 2 \\
                                            & 67 & Batteries accumulated current in mA          & 2 \\
                                            & 69 & Batteries charge in mAh                      & 2 \\
                                            & 71 & Battery monitor IC temperature in K          & 2 \\
                                            & 73 & Battery heater 1 duty cycle in \%            & 1 \\
                                            & 74 & Battery heater 2 duty cycle in \%            & 1 \\
                                            & 75 & Payload EDC status (00h=none, 01h=EDC\_1, 02h=EDC\_2, 03h=Both) & 1 \\
                                            & 76 & Payload-X status (00h=OFF,01h=ON)            & 1 \\
                                            & 77 & Radiation monitor status (00h=OFF,01h=ON)    & 1 \\
    \cmidrule{4-4}
                                            &    &                                              & 78 \\
    \multirow{3}{*}{Ping answer}            & 0  & Packet ID (21h)                      & 1 \\
                                            & 1  & Source callsign (`` PY0EFS'')        & 7 \\
                                            & 8  & Requester callsign                   & 7 \\
    \cmidrule{4-4}
                                            &    &                                      & 15 \\
    \multirow{6}{*}{Data request answer}    & 0  & Packet ID (22h)                      & 1 \\
                                            & 1  & Source callsign (`` PY0EFS'')        & 7 \\
                                            & 8  & Requester callsign                   & 7 \\
                                            & 15 & Data type ID                         & 1 \\
                                            & 16 & Timestamp                            & 4 \\
                                            & 20 & Data                                 & Var. \\
    \cmidrule{4-4}
                                            &    &                                      & 20 (min.) \\
    \multirow{5}{*}{Message broadcast}      & 0  & Packet ID (23h)                      & 1 \\
                                            & 1  & Source callsign (`` PY0EFS'')        & 7 \\
                                            & 8  & Requester callsign                   & 7 \\
                                            & 15 & Destination callsign                 & 7 \\
                                            & 22 & Message                              & up to 38 \\
    \cmidrule{4-4}
                                            &    &                                      & 22 to 60 \\
                                            & 0  & Packet ID (24h)                      & 1 \\
                                            & 1  & Source callsign (`` PY0EFS'')        & 7 \\
                                            & 8  & Payload ID (01h or 02h)              & 1 \\
                                            & 9  & PTT signal receiving time            & 4 \\
                                            & 13 & Error code                           & 1 \\
                                            & 14 & Carrier frequency                    & 2 \\
                                            & 16 & Carrier amplitude at ADC interface output & 2 \\
                                            & 18 & User message length in bytes         & 1 \\
                                            & 19 & ARGOS-2 PTT-A2 user message          & 35 \\
                                            & 54 & Current time since J2000 epoch       & 4 \\
                                            & 58 & Elapsed time since last reset        & 4 \\
   Payload data                             & 62 & System current supply in mA          & 2 \\
   (EDC info)                               & 64 & System voltage supply in mV          & 2 \\
                                            & 65 & EDC board temperature                & 1 \\
                                            & 66 & RF front end LO                      & 1 \\
                                            & 67 & RMS level at front-end output        & 2 \\
                                            & 69 & Generated PTT packages since last initialization & 1 \\
                                            & 70 & Max                                  & 1 \\
                                            & 71 & Memory error count                   & 1 \\
                                            & 72 & Current time                         & 4 \\
                                            & 76 & Number of PTT package available for reading & 1 \\
                                            & 77 & PTT decoder task status              & 1 \\
                                            & 78 & ADC sampler state                    & 1 \\
    \cmidrule{4-4}
                                            &    &                                      & 79 \\
                                            & 0  & Packet ID (24h)                      & 1 \\
                                            & 1  & Source callsign (`` PY0EFS'')        & 7 \\
                                            & 8  & Payload ID (01h or 02h)              & 1 \\
                                            & 9  & Elapsed time since J2000 epoch       & 4 \\
    Payload data                            & 13 & ADC sample packet number             & 1 \\
    (EDC samples)                           & 14 & First ADC I-sample                   & 2 \\
                                            & 16 & First ADC Q-sample                   & 2 \\
                                            & ... & ...                                 & ... \\
                                            & 214 & N ADC I-sample                      & 2 \\
                                            & 216 & N ADC Q-sample                      & 2 \\
    \cmidrule{4-4}
                                            &    &                                      & 218 \\
    \multirow{5}{*}{TC feedback}            & 0  & Packet ID (25h)                      & 1 \\
                                            & 1  & Source callsign (`` PY0EFS'')        & 7 \\
                                            & 8  & Requester callsign                   & 7 \\
                                            & 15 & TC packet ID                         & 1 \\
                                            & 16 & Timestamp                            & 4 \\
    \cmidrule{4-4}
                                            &    &                                      & 20 \\
    \multirow{6}{*}{Parameter value}        & 0  & Packet ID (26h)                      & 1 \\
                                            & 1  & Source callsign (`` PY0EFS'')        & 7 \\
                                            & 8  & Requester callsign                   & 7 \\
                                            & 15 & Subsystem ID                         & 1 \\
                                            & 16 & Parameter ID                         & 1 \\
                                            & 17 & Parameter value                      & 4 \\
    \cmidrule{4-4}
                                            &    &                                      & 21 \\
    \bottomrule[1.5pt]
    \caption{Downlink packets.}
    \label{tab:downlink-packets}
\end{longtable}

\section{Uplink}

The \autoref{tab:uplink-packets} presents the content of the uplink packets.

\begin{longtable}[c]{lcL{0.4\textwidth}c}
    \toprule[1.5pt]
    \textbf{Packet} & \textbf{Position} & \textbf{Content} & \textbf{Length [bytes]} \\
    \midrule
    \multirow{2}{*}{Ping request}       & 0  & Packet ID (40h)                      & 1 \\
                                        & 1  & Ground station callsign              & 7 \\
    \cmidrule{4-4}
                                        &    &                                      & 8 \\
    \multirow{6}{*}{Data request}       & 0  & Packet ID (41h)                      & 1 \\
                                        & 1  & Ground station callsign              & 7 \\
                                        & 8  & Data type ID                         & 1 \\
                                        & 9  & Start timestamp                      & 4 \\
                                        & 13 & End timestamp                        & 4 \\
                                        & 17 & HMAC hash                            & 20 \\
    \cmidrule{4-4}
                                        &    &                                      & 37 \\
    \multirow{4}{*}{Broadcast message}  & 0  & Packet ID (42h)                      & 1 \\
                                        & 1  & Ground station callsign              & 7 \\
                                        & 8  & Destination callsign                 & 7 \\
                                        & 15 & Message                              & up to 38 \\
    \cmidrule{4-4}
                                        &    &                                      & up to 53 \\
    \multirow{4}{*}{Enter hibernation}  & 0  & Packet ID (43h)                      & 1 \\
                                        & 1  & Ground station callsign              & 7 \\
                                        & 8  & Hibernation in hours                 & 2 \\
                                        & 10 & HMAC hash                            & 20 \\
    \cmidrule{4-4}
                                        &    &                                      & 30 \\
    \multirow{3}{*}{Leave hibernation}  & 0  & Packet ID (44h)                      & 1 \\
                                        & 1  & Ground station callsign              & 7 \\
                                        & 8  & HMAC hash                            & 20 \\
    \cmidrule{4-4}
                                        &    &                                      & 28 \\
    \multirow{4}{*}{Activate module}    & 0  & Packet ID (45h)                      & 1 \\
                                        & 1  & Ground station callsign              & 7 \\
                                        & 8  & Module ID                            & 1 \\
                                        & 9  & HMAC hash                            & 20 \\
    \cmidrule{4-4}
                                        &    &                                      & 29 \\
    \multirow{4}{*}{Deactivate module}  & 0  & Packet ID (46h)                      & 1 \\
                                        & 1  & Ground station callsign              & 7 \\
                                        & 8  & Module ID                            & 1 \\
                                        & 9  & HMAC hash                            & 20 \\
    \cmidrule{4-4}
                                        &    &                                      & 29 \\
    \multirow{4}{*}{Activate payload}   & 0  & Packet ID (47h)                      & 1 \\
                                        & 1  & Ground station callsign              & 7 \\
                                        & 8  & Payload ID                           & 1 \\
                                        & 9  & HMAC hash                            & 20 \\
    \cmidrule{4-4}
                                        &    &                                      & 29 \\
    \multirow{4}{*}{Deactivate payload} & 0  & Packet ID (48h)                      & 1 \\
                                        & 1  & Ground station callsign              & 7 \\
                                        & 8  & Payload ID                           & 1 \\
                                        & 9  & HMAC hash                            & 20 \\
    \cmidrule{4-4}
                                        &    &                                      & 29 \\
    \multirow{3}{*}{Erase memory}       & 0  & Packet ID (49h)                      & 1 \\
                                        & 1  & Ground station callsign              & 7 \\
                                        & 8  & HMAC hash                            & 20 \\
    \cmidrule{4-4}
                                        &    &                                      & 28 \\
    \multirow{3}{*}{Force reset}        & 0  & Packet ID (4Ah)                      & 1 \\
                                        & 1  & Ground station callsign              & 7 \\
                                        & 8  & HMAC hash                            & 20 \\
    \cmidrule{4-4}
                                        &    &                                      & 28 \\
    \multirow{5}{*}{Get payload data}   & 0  & Packet ID (4Bh)                      & 1 \\
                                        & 1  & Ground station callsign              & 7 \\
                                        & 8  & Payload ID                           & 1 \\
                                        & 9  & Payload arguments                    & 12 \\
                                        & 21 & HMAC hash                            & 20 \\
    \cmidrule{4-4}
                                        &    &                                      & 41 \\
    \multirow{6}{*}{Set parameter}      & 0  & Packet ID (4Ch)                      & 1 \\
                                        & 1  & Ground station callsign              & 7 \\
                                        & 8  & Subsystem ID                         & 1 \\
                                        & 9  & Parameter ID                         & 1 \\
                                        & 10 & Parameter value                      & 4 \\
                                        & 14 & HMAC hash                            & 20 \\
    \cmidrule{4-4}
                                        &    &                                      & 34 \\
    \multirow{5}{*}{Get parameter}      & 0  & Packet ID (4Dh)                      & 1 \\
                                        & 1  & Ground station callsign              & 7 \\
                                        & 8  & Subsystem ID                         & 1 \\
                                        & 9  & Parameter ID                         & 1 \\
                                        & 10 & HMAC hash                            & 20 \\
    \cmidrule{4-4}
                                        &    &                                      & 30 \\
    \bottomrule[1.5pt]
    \caption{Uplink packets.}
    \label{tab:uplink-packets}
\end{longtable}
